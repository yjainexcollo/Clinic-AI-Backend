# ============================================================================
# Clinic-AI Backend Environment Configuration Template
# ============================================================================
# Copy this file to .env.local and fill in your actual values
# cp env.example .env.local
# 
# IMPORTANT: 
# - Never commit .env.local to git (it contains secrets!)
# - Replace all placeholder values with your actual credentials
# - For production, use Azure Key Vault instead of .env files
# ============================================================================

# ============================================================================
# Application Settings
# ============================================================================
APP_ENV=development
DEBUG=true
PORT=8000
HOST=0.0.0.0

# ============================================================================
# MongoDB Configuration
# ============================================================================
# For cloud MongoDB (Azure Cosmos DB, MongoDB Atlas, production):
MONGO_URI=mongodb+srv://username:password@cluster.mongodb.net/
MONGO_DB_NAME=clinicai

# For local Docker MongoDB (used by docker-compose):
# These are used to create the MongoDB container with specific credentials
# Default values are: admin/password/clinicai (safe for local development)
MONGO_USERNAME=admin
MONGO_PASSWORD=password

# ============================================================================
# Security Configuration
# ============================================================================
# Secret key for JWT token signing (must be at least 32 characters)
# Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"
SECURITY_SECRET_KEY=your_secret_key_here_must_be_at_least_32_characters_long

# Encryption key for PHI-safe operations (must be base64-encoded 32-byte key)
# Generate: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ENCRYPTION_KEY=your_base64_encoded_32_byte_key_here

# ============================================================================
# Authentication Configuration (REQUIRED for HIPAA Compliance)
# ============================================================================
# Format: "key1:user1,key2:user2" (comma-separated key:user pairs)
# Each API key maps to a user identifier for audit logging
# Example: API_KEYS=abc123:doctor1,def456:doctor2,ghi789:nurse1
# For production, store in Azure Key Vault as secret "API-KEYS" instead
API_KEYS=your_api_key_here:user1,another_key:user2

# ============================================================================
# Azure OpenAI Configuration (Preferred for production)
# ============================================================================
# Get these from Azure Portal > Azure OpenAI Resource > Keys and Endpoint
AZURE_OPENAI_ENDPOINT=https://your-resource-name.openai.azure.com/
AZURE_OPENAI_API_KEY=your_azure_openai_api_key_here
AZURE_OPENAI_API_VERSION=2025-01-01-preview
AZURE_OPENAI_DEPLOYMENT_NAME=gpt-4o-mini

# ============================================================================
# Azure Blob Storage Configuration
# ============================================================================
# Get connection string from: Azure Portal > Storage Account > Access Keys
AZURE_BLOB_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=your_storage_account;AccountKey=your_key_here;EndpointSuffix=core.windows.net
AZURE_BLOB_CONTAINER_NAME=clinicai-uploads
AZURE_BLOB_DEFAULT_EXPIRY_HOURS=24
AZURE_BLOB_MAX_FILE_SIZE_MB=100

# ============================================================================
# Azure Queue Storage Configuration
# ============================================================================
# If not set, automatically uses AZURE_BLOB_CONNECTION_STRING (same storage account)
AZURE_QUEUE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=your_storage_account;AccountKey=your_key_here;EndpointSuffix=core.windows.net
AZURE_QUEUE_QUEUE_NAME=transcription-queue-dev
AZURE_QUEUE_VISIBILITY_TIMEOUT=3600
AZURE_QUEUE_MAX_RETRY_ATTEMPTS=3
AZURE_QUEUE_POLL_INTERVAL=2
AZURE_QUEUE_MAX_DEQUEUE_COUNT=5
AZURE_QUEUE_PROCESSING_STALE_SECONDS=4000

# ============================================================================
# Azure Speech Service Configuration
# ============================================================================
# Get these from: Azure Portal > Speech Service > Keys and Endpoint
AZURE_SPEECH_SUBSCRIPTION_KEY=your_speech_service_key_here
AZURE_SPEECH_REGION=centralindia
AZURE_SPEECH_ENDPOINT=https://centralindia.api.cognitive.microsoft.com/
AZURE_SPEECH_MAX_SPEAKERS=2
AZURE_SPEECH_TRANSCRIPTION_MODE=batch
AZURE_SPEECH_BATCH_POLLING_INTERVAL=3
AZURE_SPEECH_BATCH_MAX_WAIT_TIME=2400
AZURE_SPEECH_ENABLE_SPEAKER_DIARIZATION=true
AZURE_SPEECH_ENABLE_WORD_LEVEL_TIMESTAMPS=false

# ============================================================================
# Azure Key Vault Configuration (Production)
# ============================================================================
# Name of your Azure Key Vault (optional - not needed for local dev)
# The app will try to load secrets from Key Vault if this is set
AZURE_KEY_VAULT_NAME=your-key-vault-name

# ============================================================================
# Azure Application Insights (Monitoring & Observability)
# ============================================================================
# Get from: Azure Portal > Application Insights > Properties > Connection String
APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=your-instrumentation-key;IngestionEndpoint=https://region.in.applicationinsights.azure.com/;LiveEndpoint=https://region.livediagnostics.monitor.azure.com/;ApplicationId=your-app-id

# ============================================================================
# Transcription Service Configuration
# ============================================================================
TRANSCRIPTION_SERVICE=azure_speech

# Enable transcription worker in main app (set to true to run worker in same process)
# For production, consider running worker as separate service
ENABLE_TRANSCRIPTION_WORKER=false

# Worker Configuration
TRANSCRIPTION_WORKER_CONCURRENCY=5
PROCESSING_STALE_SECONDS=60

# Transcription LLM Configuration
TRANSCRIPTION_SIMPLE_MAX_CHARS=20000

# Stuck Job Sweeper Configuration
TRANSCRIPTION_STUCK_SWEEPER_ENABLED=true
TRANSCRIPTION_STUCK_SLEEPER_INTERVAL_SECONDS=300
TRANSCRIPTION_STUCK_SLEEPER_THRESHOLD_SECONDS=600

# ============================================================================
# Optional: OpenAI Configuration (Fallback)
# ============================================================================
# Only needed if not using Azure OpenAI
# Uncomment and set if you want to use OpenAI API instead of Azure OpenAI
# OPENAI_API_KEY=sk-your-openai-api-key-here
# OPENAI_MODEL=gpt-4o-mini
# OPENAI_MAX_TOKENS=4000
# OPENAI_TEMPERATURE=0.3

# ============================================================================
# Development Notes
# ============================================================================
# Local Development Setup:
# 1. Copy this file: cp env.example .env.local
# 2. Fill in your actual Azure credentials from Azure Portal
# 3. For MongoDB, use Docker: docker compose up -d mongodb
# 4. Start the app: make dev
#
# Required Azure Resources:
# - Azure OpenAI Service (with gpt-4o-mini deployment)
# - Azure Storage Account (for Blob + Queue storage)
# - Azure Speech Service (for transcription)
# - Azure Application Insights (for monitoring)
# - Azure Key Vault (optional, for production secrets management)
#
# Security Best Practices:
# - Never commit .env.local to git
# - Use different keys for dev/staging/production
# - Rotate keys regularly
# - Use Azure Key Vault for production secrets
# - Use Managed Identities when possible (Azure)
# ============================================================================